[general]
static=yes
writeprotect=no
lastaction=""

[parking]
exten => b_exten,1,Answer()
exten => b_exten,n,NOOP(incoming call from userA)
exten => b_exten,n,Wait(1)
exten => b_exten,n,SendDTMF(1w1w0)
exten => b_exten,n,Wait(1)
exten => b_exten,n,NOOP(trying to park the call- one step parking)
exten => b_exten,n,SET(GLOBAL(lastaction)=park)
exten => b_exten,n,SendDTMF(#w7w2)
exten => b_exten,n,Wait(2)
exten => b_exten,n,Hangup()

exten => h,1,GotoIF($["${GLOBAL(lastaction)}"="park"]?retrieve)
exten => h,n,Hangup()
exten => h,n(retrieve),NOOP(Got Hangup due to successfull parking -> call 701 in order to retrieve userA)
exten => h,n,SET(GLOBAL(lastaction)=initCall)
exten => h,n,AGI(agi://127.0.0.1:4600) ; initiate call to retrieve userA
exten => h,n,Hangup()

exten => retrieve_A,1,Answer()
exten => retrieve_A,n,NOOP(okay, I should now be connected to userA -> trying to sync)
exten => retrieve_A,n(sync),Wait(1)
exten => retrieve_A,n,Read(sync,,3,,,8) ;wait more than 5 but less than 10 seconds
exten => retrieve_A,n,GotoIf($["${sync}"="999"]?DTMFpass:DTMFfail)
exten => retrieve_A,n(DTMFpass),NOOP(read '${sync}' and expected '999' - OK)
exten => retrieve_A,n,NOOP(TEST PASSED!)
exten => retrieve_A,n,Set(GLOBAL(lastaction)=success)
exten => retrieve_A,n,AGI(agi://127.0.0.1:4574)
exten => retrieve_A,n,Hangup()

exten => retrieve_A,n(DTMFfail),NOOP(read '${sync}' and exptected '999' - FAILURE)
exten => retrieve_A,n,NOOP(trying to sync again!)
exten => retrieve_A,n,Goto(sync)


