#!/usr/bin/env python
'''
Copyright (C) 2010, Digium, Inc.
Terry Wilson <twilson@digium.com>

This program is free software, distributed under the terms of
the GNU General Public License Version 2.
'''

import sys
import os
import logging
import re
sys.path.append("lib/python")
from asterisk.asterisk import Asterisk
from asterisk.cdr import AsteriskCSVCDR, AsteriskCSVCDRLine
from asterisk.TestCase import TestCase
from asterisk.CDRTestCase import CDRTestCase
from twisted.internet import reactor
from asterisk.version import AsteriskVersion

class SIP_Dial_Answer_Test(CDRTestCase):
    def __init__(self):
        CDRTestCase.__init__(self)
        cdr2channel = "SIP/test-.*"

        self.add_expectation('cdrtest_local', AsteriskCSVCDRLine(
            destination="1",
            dcontext="default",
            channel="Local/1@default-.*",
            disposition="ANSWERED",
            amaflags="DOCUMENTATION"))

        if self.ast_version < AsteriskVersion("1.8"):
                cdr2channel = "Local/2@test-.*"

        self.add_expectation('cdrtest_sip', AsteriskCSVCDRLine(
            destination="2",
            dcontext="test",
            channel=cdr2channel,
            disposition="ANSWERED",
            amaflags="DOCUMENTATION"))

def main():
    test = SIP_Dial_Answer_Test()
    test.start_asterisk()
    reactor.run()
    test.stop_asterisk()
    return test.results()

if __name__ == '__main__':
    sys.exit(main())

# vim:sw=4:ts=4:expandtab:textwidth=79
