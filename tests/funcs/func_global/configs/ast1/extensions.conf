[default]

exten => echo,1,NoOp()
	same => n,Answer()
	same => n,Echo()

exten => test,1,NoOp()
	same => n,Answer()
	same => n,Set(GLOBAL(global_channel)=${CHANNEL})
	same => n,Set(SHARED(foo)=bar)
	same => n,Originate(Local/newchan@default,exten,default,echo,1)
	same => n,Set(test_counter=0)
	same => n(loop),GotoIf($[${SHARED(foo,${CHANNEL})}=baz]?pass:)
	same => n,Wait(1)
	same => n,Set(test_counter=${INC(test_counter)})
	same => n,GotoIf($[${test_counter}=5]?fail:loop)
	same => n(fail),NoOp()
	same => n,UserEvent(TestResult,Status:fail)
	same => n,Hangup()
	same => n(pass),NoOp()
	same => n,UserEvent(TestResult,Status:pass)
	same => n,Hangup()

exten => newchan,1,NoOp()
	same => n,Answer()
	same => n,Set(shared_channel=${GLOBAL(global_channel)})
	same => n,Set(foo=${SHARED(foo,${shared_channel})})
	same => n,GotoIf($[${foo}=bar]?pass:fail)
	same => n(fail),NoOp()
	same => n,UserEvent(TestResult,Status:fail)
	same => n,Hangup()
	same => n(pass),NoOp()
	same => n,Set(SHARED(foo,${shared_channel})=baz)
	same => n,Hangup()
