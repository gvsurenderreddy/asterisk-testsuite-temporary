testinfo:
    summary: 'Test call parking timeouts for comebacktoorigin off'
    description: |
        'This test builds on the more generic parkcall test. With comebacktoorigin disabled,
         we are primarily interested in seeing where in the dialplan the parked channel gets
         sent when it is placed back into the PBX and that all of the values we mention in
         the sample configuration are set appropriately. Also we want to make sure the park-dial
         extension to dial the parker is created.'

test-modules:
    add-test-to-search-path: 'True'
    test-object:
        config-section: bridge-config
        typename: 'BridgeTestCase.BridgeTestCase'
    modules:
        -
            config-section: 'cdr-config'
            typename: 'cdr.CDRModule'

        -
            typename: 'Executioner.Executioner'

bridge-config:
    -
        originate_channel: 'SIP/test1@uut'
        features:
            -
                who: 'alice'
                what: 'parkcall'
                success: 'true'
    -
        originate_channel: 'SIP/test2@uut'
        features:
            -
                who: 'alice'
                what: 'parkcall'
                success: 'true'
    -
        originate_channel: 'SIP/test3@uut'
        features:
            -
                who: 'alice'
                what: 'parkcall'
                success: 'true'

cdr-config:
    -
        file: 'Master'
        lines:
            -
                source: '1234'
                destination: 'test1'
                dcontext: 'default'
                callerid: '"Alice" <1234>'
                channel: '.*/alice-.*'
                dchannel: '.*/bob-.*'
                lastapp: 'Dial'
                disposition: 'ANSWERED'
                amaflags: 'DOCUMENTATION'
            -
                source: '1234'
                destination: 'test2'
                dcontext: 'default'
                callerid: '"Alice" <1234>'
                channel: '.*/alice-.*'
                dchannel: '.*/bob-.*'
                lastapp: 'Dial'
                disposition: 'ANSWERED'
                amaflags: 'DOCUMENTATION'
            -
                source: '1234'
                destination: 'test3'
                dcontext: 'default'
                callerid: '"Alice" <1234>'
                channel: '.*/alice-.*'
                dchannel: '.*/bob-.*'
                lastapp: 'Dial'
                disposition: 'ANSWERED'
                amaflags: 'DOCUMENTATION'

properties:
    minversion: '12.0.0'
    dependencies:
        - python : 'twisted'
        - python : 'starpy'
    tags:
        - bridge
