[general]

[globals]

[pickuptest]

exten => h,1,GoToIf($[${RINGING_EXTEN}=1]?is_ringing:bye)

; this is the ringing channel, see if it got picked up correctly or not.
exten => h,n(is_ringing),GoToIf($[${RINGING_EXTEN_PASS}=1]?is_ringing_passed:is_ringing_failed)

exten => h,n(is_ringing_failed),AGI(agi://127.0.0.1:4574) ;Tell the test script pickup failed
exten => h,n,GoTo(pickuptest,h,bye) ; finish

exten => h,n(is_ringing_passed),AGI(agi://127.0.0.1:4573) ;Tell the test script pickup passed
exten => h,n(bye),NoOp(Bye ${CHANNEL})


exten => 1001,1,Dial(IAX2/iax_pickup_b@127.0.0.1/ringing_exten)

;test 1 with no options
exten => 1002,1,PickupChan(IAX2/iax_pickup_b)
exten => 1002,n,Wait(1)
exten => 1002,n,Hangup()

;test 2 with 'p' option
exten => 1003,1,PickupChan(IAX2/iax_pickup,p)
exten => 1003,n,Wait(1)
exten => 1003,n,Hangup()

; this exten Answers and waits for the other side to answer
exten => waiting_exten,1,Answer()
exten => waiting_exten,n,Wait(10)

; this exten never answers and expects another channel to pick it up during its wait period
exten => ringing_exten,1,Set(RINGING_EXTEN=1)
exten => ringing_exten,n,Set(RINGING_EXTEN_PASS=1)
exten => ringing_exten,n,Wait(10)
exten => ringing_exten,n,NoOp(This should not get called)

; this exten should be hungup on before reaching this
exten => ringing_exten,n,Set(RINGING_EXTEN_PASS=0)
exten => ringing_exten,n,Hangup()

