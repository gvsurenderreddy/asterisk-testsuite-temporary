[general]
static=yes
writeprotect=no

[parkingAB]
exten => b_exten,1,Answer()
exten => b_exten,n,NOOP(userB answered the call)
exten => b_exten,n,Wait(1)
exten => b_exten,n,NOOP(sync to userA -> send  DTMF '110')
exten => b_exten,n,SendDTMF(1w1w0)
exten => b_exten,n,Wait(1)
exten => b_exten,n,NOOP(trying to Park userA)
exten => b_exten,n,Set(GLOBAL(lastaction)=parkedA)
exten => b_exten,n,SendDTMF(#)
exten => b_exten,n,Wait(1)
exten => b_exten,n,SendDTMF(7w0w0)
exten => b_exten,n,Hangup()

exten => h,1,NOOP(got hangup due to successful parking of userA)
exten => h,n,AGI(agi://127.0.0.1:4574)
exten => h,n,Hangup()

[parkingBC]
exten => b_exten,1,Answer()
exten => b_exten,n,NOOP(userB answered the call)
exten => b_exten,n,Wait(1)
exten => b_exten,n,NOOP(waiting for DTMF '110' from userB)
exten => b_exten,n,Read(sync,,3,,,10) ;read 3 digits, 5sek timeout
exten => b_exten,n,GotoIF($["${sync}"="110"]?DTMFpass:DTMFfail)
exten => b_exten,n(DTMFpass),NOOP(read '${sync}' and expected '110' --> OK)
exten => b_exten,n,NOOP(somewhere in the future I get parked!)
exten => b_exten,n,NOOP(I will send DTMF '888' every 5 seconds in order to sync when I get reconnected)
exten => b_exten,n,Set(count=1)
exten => b_exten,n(sync),Wait(5)
exten => b_exten,n,NOOP(Attempt ${count} to sync)
exten => b_exten,n,Set(count=$[${count}+1])
exten => b_exten,n,SendDTMF(888)
exten => b_exten,n,Goto(sync)
exten => b_exten,n(DTMFfail),NOOP(read '${sync}' and expected '110' --> FAILURE)
exten => b_exten,n,Hangup()
