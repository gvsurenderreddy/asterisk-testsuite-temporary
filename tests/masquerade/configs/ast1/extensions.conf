[general]
static=yes
writeprotect=no
lastaction=""

[outgoing]
exten => _9XXX,1,NoOp(Call to park)
exten => _9XXX,n,Set(FIRST=1)
exten => _9XXX,n,Goto(optout,${EXTEN},1)

[optout]
exten => _9XXX,1,NoOp(Local channel chain to park call)
exten => _9XXX,n,GotoIf($[${EXTEN} = 9000]?done:)
exten => _9XXX,n,Dial(Local/$[${EXTEN} - 1]@optout)
exten => _9XXX,n,UserEvent(ast1,status: FAILURE Dial Local continued in dialplan)
exten => _9XXX,n,Hangup()
exten => _9XXX,n(done),Dial(IAX2/ast2/${EXTEN},30)
exten => _9XXX,n,UserEvent(ast1,status: FAILURE Dial IAX continued in dialplan)
exten => _9XXX,n,Hangup()

exten => h,1,NoOp(Report local channel optimized out)
exten => h,n,GotoIf($[x${FIRST}x = x1x]?first:)
exten => h,n,UserEvent(optout,status: REMOVED)
exten => h,n(first),NoOp()

[parked]
exten => parkme,1,NoOp(Park the outgoing call)
exten => parkme,n,Park(,parked,failed,1)
exten => parkme,n,UserEvent(ast1,status: FAILURE Park continued in dialplan)
exten => parkme,n,Hangup()

exten => failed,1,NoOp(Parked call failed to be picked up before timeout)
exten => failed,n,UserEvent(ast1,status: FAILURE Park timeout)
exten => failed,n,Hangup()
