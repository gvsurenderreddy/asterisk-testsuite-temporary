[general]

[globals]
DEBUG=FAIL - nothing done

[agitest]
exten => echo,1,Answer()
exten => echo,n,Echo()

; Used in connect, hangup, control-stream-file, stream-file, database,
; execute, get-data, record-file, say-alpha, say-date, say-datetime,
; say-time, say-digits, say-number, say-phonetic
exten => basic_agi,1,Answer()
exten => basic_agi,n,Set(GLOBAL(DEBUG)=FAIL - before agi)
exten => basic_agi,n,AGI(agi://127.0.0.1:4573)
exten => basic_agi,n,Set(GLOBAL(DEBUG)=${AGISTATUS})
exten => basic_agi,n,HangUp()

; Used in channel-status
exten => no_answer,1,Set(GLOBAL(DEBUG)=FAIL - before agi)
exten => no_answer,n,AGI(agi://127.0.0.1:4573)
exten => no_answer,n,Set(GLOBAL(DEBUG)=${AGISTATUS})
exten => no_answer,n,HangUp()

; Used in get-data
exten => play_dtmf,1,Answer()
exten => play_dtmf,n,Set(GLOBAL(DEBUG)=FAIL - play_dtmf answered)
exten => play_dtmf,n,SendDTMF(w3w2w1w2w3w3w3w#)
exten => play_dtmf,n,Set(GLOBAL(DEBUG)=FAIL - play_dtmf sent DTMF)
exten => play_dtmf,n,HangUp()

; Used in record-file
exten => play_snd_and_term,1,Answer()
exten => play_snd_and_term,n,Set(GLOBAL(DEBUG)=FAIL - play_snd_and_term answered)
exten => play_snd_and_term,n,Wait(1)
exten => play_snd_and_term,n,Playback(beep)
exten => play_snd_and_term,n,SendDTMF(#)
exten => play_snd_and_term,n,Set(GLOBAL(DEBUG)=FAIL - play_snd_and_term sent sounds and exit digit)
exten => play_snd_and_term,n,HangUp()

; Used in record-file
exten => play_snd_and_hangup,1,Answer()
exten => play_snd_and_hangup,n,Set(GLOBAL(DEBUG)=FAIL - play_snd_and_hangup answered)
exten => play_snd_and_hangup,n,Wait(1)
exten => play_snd_and_hangup,n,Playback(beep)
exten => play_snd_and_hangup,n,Set(GLOBAL(DEBUG)=FAIL - play_snd_and_hangup sent sounds)
exten => play_snd_and_hangup,n,HangUp()

; Used in say-alpha, say-date, say-datetime, say-time, say-digits, say-number, say-phonetic
; listen for the AGI script to talk
; check to see if we detected any talking
; notify AGI script over a second port if talkdetect succeeds.
exten => td_and_agi_notify,1,Answer()
exten => td_and_agi_notify,n,Set(GLOBAL(DEBUG)=FAIL - td_and_agi_notify answered)
exten => td_and_agi_notify,n,Set(TALK_DETECTED=0)
exten => td_and_agi_notify,n,BackgroundDetect(silence/10,100,10,20000)
exten => td_and_agi_notify,n,Wait(15)
exten => td_and_agi_notify,n,Set(GLOBAL(DEBUG)=FAIL - td_and_agi_notify listening for sounds)
exten => td_and_agi_notify,n,GoToIf($[${TALK_DETECTED}=0]?fail:pass)
exten => td_and_agi_notify,n(fail),Set(GLOBAL(DEBUG)=FAIL - talk detect failed with result ${TALK_DETECTED})
exten => td_and_agi_notify,n,HangUp()
exten => td_and_agi_notify,n(pass),Set(GLOBAL(DEBUG)=PASS)
exten => td_and_agi_notify,n,AGI(agi://127.0.0.1:4574)
exten => td_and_agi_notify,n,HangUp()

