[general]

[globals]

[mixmonitortest]
exten => test1,1,Answer()
exten => test1,n,MixMonitor(${TESTAUDIO1})
exten => test1,n,Playback(${TALK_AUDIO})
exten => test1,n,StopMixMonitor()

;If PlayBack fails, then StopMixMonitor has not yet let go of the file
exten => test1,n,PlayBack(${TESTAUDIO1})
exten => test1,n,GoToIf($[${PLAYBACKSTATUS} = SUCCESS]?domore:stopnow)

; StopMixMonitor failed to let go of the file as we could not play it back
exten => test1,n(stopnow),HangUp()

; StopMixMonitor worked, now test stopping on hangup
exten => test1,n(domore), MixMonitor(${TESTAUDIO2})
exten => test1,n,Playback(${TALK_AUDIO})
exten => test1,n,HangUp()

; Test 2 verifies the TESTAUDIO2 file was released during hangup of the previous test
exten => test2,1,PlayBack(${TESTAUDIO2})
exten => test2,n,GoToIf($[${PLAYBACKSTATUS} = SUCCESS]?domore2:stopnow2)

exten => test2,n(stopnow2),HangUp()

exten => test2,n(domore2), MixMonitor(${TESTAUDIO3})
exten => test2,n,Playback(${TALK_AUDIO})
exten => test2,n,HangUp()



