testinfo:
    summary: 'Test execution of app_voicemails VoiceMailMain new user persistence when a user hangs up'
    description: |
        This test verifies that if a new user fails to change their password,
        subsequent dials to the voicemailbox will still require them to change
        their password until they successfully change it.

properties:
    minversion: '1.8'
    buildoption: 'TEST_FRAMEWORK'
    testconditions:
        -
            name: 'asterisk.ThreadTestCondition.ThreadPreTestCondition'
            type: 'Pre'
        -
            name: 'asterisk.ThreadTestCondition.ThreadPostTestCondition'
            type: 'Post'
            ignoredThreads:
                - 'netconsole'
                - 'pbx_thread'
            relatedCondition: 'asterisk.ThreadTestCondition.ThreadPreTestCondition'
        -
            name: 'asterisk.SipDialogTestCondition.SipDialogPreTestCondition'
            type: 'Pre'
        -
            # Note: the abrupt hangup will leave the SIP dialog in flight
            name: 'asterisk.SipDialogTestCondition.SipDialogPostTestCondition'
            type: 'Post'
            expectedResult: 'FAIL'
            sipHistoryRequirements:
                - 'NewChan'
        -
            name: 'asterisk.LockTestCondition.LockTestCondition'
            type: 'Pre'
        -
            name: 'asterisk.LockTestCondition.LockTestCondition'
            type: 'Post'
    dependencies:
        - python : 'twisted'
        - python : 'starpy'
        - asterisk : 'app_voicemail'
        - asterisk : 'app_senddtmf'
        - asterisk : 'app_playback'
